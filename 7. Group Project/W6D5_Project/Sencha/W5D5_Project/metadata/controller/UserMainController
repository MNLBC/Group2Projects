{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "UserMainController",
        "id": "userMainController"
    },
    "name": "MyController",
    "designerId": "19c4cdf1-f966-4805-9519-99c396a5951b",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#countryRegCombo",
                "designer|targetType": "MyComboBox6",
                "fn": "onCountryRegComboChange",
                "implHandler": [
                    "        var state = Ext.getStore('SPStore');",
                    "        var country = Ext.getCmp('countryRegCombo').value;",
                    "        state.filter('CountryName', country);"
                ],
                "name": "change",
                "scope": "me"
            },
            "name": "onCountryRegComboChange",
            "designerId": "53d1982c-aee2-468d-aadb-ad7afdd57438"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#loginBtn",
                "designer|targetType": "MyButton9",
                "fn": "onLoginBtnClick",
                "implHandler": [
                    "var store = Ext.getStore('UserStore');",
                    "var email = Ext.getCmp('emailLoginField').getValue();",
                    "var password = Ext.getCmp('passLoginField').getValue();",
                    "var main = Ext.getCmp('setPanel');",
                    "//             var admin = Ext.getCmp('userPanel');",
                    "var home1 = Ext.getCmp('headerPanel');",
                    "var home2 = Ext.getCmp('subHeaderPanel');",
                    "var home3 = Ext.getCmp('categoryPanel');",
                    "var admin1 = Ext.getCmp('userMgmtBtn');",
                    "var admin2 = Ext.getCmp('prodMgmtBtn'),",
                    "    admin3 = Ext.getCmp('userReqBtn'),",
                    "    record = '';",
                    "var isExist = false;",
                    "",
                    "if (!Ext.getCmp('loginPanel').isValid()) {",
                    "    Ext.Msg.alert(\"Login\", \"Please fill out email and password\");",
                    "    return;",
                    "}",
                    "Ext.Ajax.request({",
                    "    url : \"login\",",
                    "    method : \"POST\",",
                    "    async : false,",
                    "    params : {",
                    "        email : email,",
                    "        password : password",
                    "    },",
                    "    callback : function(options, success, response) {",
                    "        if (Ext.isEmpty(response.responseText)) {",
                    "            Ext.Msg.alert(\"User\", \"Sorry but you are prohibited to access this site\");",
                    "        } else if (response.responseText == 'true') {",
                    "            Ext.Ajax.request({",
                    "                url : \"getUserByEmail\",",
                    "                method : \"GET\",",
                    "                async : false,",
                    "                params : {",
                    "                    email : email",
                    "                },",
                    "                callback : function(options, success, response) {",
                    "                    if (!Ext.isEmpty(response.responseText)) {",
                    "                        record = Ext.decode(response.responseText);",
                    "                        record = record[0];",
                    "                        isExist = true;",
                    "                        if (record.userType == 'Admin') {",
                    "                            // \t\t\t\t\t\t\tadmin1.show();",
                    "                            // \t\t\t\t\t\t\tadmin2.show();",
                    "                            Ext.Ajax.request({",
                    "                                url : \"runAdminConsumer\",",
                    "                                method : \"GET\",",
                    "                                async : false,",
                    "                                callback : function(options, success, response){",
                    "                                    if(response.responseText==1){",
                    "                                        console.log('Run Admin Topic Subscriber');",
                    "                                    }",
                    "                                }",
                    "                            });",
                    "                            admin3.show();",
                    "                        }",
                    "                        store.add(record);",
                    "                        Ext.Ajax.request({",
                    "                            url : \"getAllProducts\",",
                    "                            method : 'GET',",
                    "                            async : false,",
                    "                            callback : function(options, success, response) {",
                    "                                if (Ext.isEmpty(response.responseText)) {",
                    "                                    Ext.Msg.alert(\"Products\",",
                    "                                                  \"Error in getting products\");",
                    "                                } else {",
                    "                                    var prodStore = Ext.getStore('ProductStore');",
                    "                                    var jsonResponse = Ext.JSON.decode(response.responseText);",
                    "                                    prodStore.loadData(jsonResponse);",
                    "                                    var panel = Ext.getCmp('mainTabPanel');",
                    "                                    var tab = Ext.getCmp('digitalPanel');",
                    "                                    var userField = Ext.getCmp('userField');",
                    "                                    var countField = Ext.getCmp('countField'),",
                    "                                        idField = Ext.getCmp('idField'),",
                    "                                        addField = Ext.getCmp('addField'),",
                    "                                        emailField = Ext.getCmp('emailField'),",
                    "                                        levelField = Ext.getCmp('levelField');",
                    "                                    panel.setActiveTab(tab);",
                    "                                    var controller = W5D5_Project.app.getController('ShopController');",
                    "                                    controller.clearItems();",
                    "                                    controller.addProductsToPage('digital');",
                    "                                    home1.show();",
                    "                                    home2.show();",
                    "                                    home3.show();",
                    "                                    userField.setValue(record.userFname);",
                    "                                    idField.setValue(record.userId);",
                    "                                    if(Ext.isEmpty(record.userAddress2)){",
                    "                                       addField.setValue(record.userAddress1 + ', ' + record.userCity + ', ' + record.userSp + ', ' + record.userCountry);",
                    "                                    }else{",
                    "                                       addField.setValue(record.userAddress1 + ', ' + record.userAddress2 + ', ' + record.userCity + ', ' + record.userSp + ', ' + record.userCountry);",
                    "                                    }",
                    "",
                    "                                    emailField.setValue(record.userEmail);",
                    "                                    levelField.setValue(record.userType);",
                    "",
                    "                                    Ext.Ajax.request ({",
                    "                                        url: \"visitorCount\",",
                    "                                        method: 'GET',",
                    "                                        async: false,",
                    "                                        callback : function(options, success, response) {",
                    "                                            if (success === true) {",
                    "                                                var count = response.responseText;",
                    "                                                countField.setValue(count);",
                    "                                            }",
                    "                                        }",
                    "                                    });",
                    "",
                    "                                    Ext.Ajax.request ({",
                    "                                        url: \"favoriteItems\",",
                    "                                        method: 'POST',",
                    "                                        params: {",
                    "                                            userId:Ext.getCmp('idField').getValue()",
                    "                                        },",
                    "                                        async: false,",
                    "                                        callback : function(options, success, response) {",
                    "                                            if (success === true) {",
                    "                                                var faveStore = Ext.getStore('FavoriteItemsStore');",
                    "                                                var result = Ext.JSON.decode(response.responseText);",
                    "                                                faveStore.loadData(result);",
                    "                                            }",
                    "                                        }",
                    "                                    });",
                    "                                    Ext.Ajax.request ({",
                    "                                        url: \"getCartByUser\",",
                    "                                        method: 'POST',",
                    "                                        params: {",
                    "                                            userid:Ext.getCmp('idField').getValue()",
                    "                                        },",
                    "                                        async: false,",
                    "                                        callback : function(options, success, response) {",
                    "                                            if (success === true) {",
                    "                                                var cartStore = Ext.getStore('CartProductStore');",
                    "                                                var resultSet = Ext.JSON.decode(response.responseText);",
                    "                                                cartStore.loadData(resultSet);",
                    "                                            }",
                    "                                        }",
                    "                                    });",
                    "                                }",
                    "                            }",
                    "                        });",
                    "                    }",
                    "                }",
                    "            });",
                    "        } else {",
                    "            Ext.Msg.alert(\"User\", \"Login details are invalid.\");",
                    "        }",
                    "    }",
                    "});",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onLoginBtnClick",
            "designerId": "2520b9d5-b5b3-4f4c-ba41-b8145ee36b5a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#registerBtn",
                "designer|targetType": "MyButton10",
                "fn": "onRegisterBtnClick",
                "implHandler": [
                    "var fname = Ext.getCmp('fnameRegField').getValue();",
                    "var lname = Ext.getCmp('lnameRegField').getValue();",
                    "var email = Ext.getCmp('emailRegField').getValue();",
                    "var address1 = Ext.getCmp('address1RegField').getValue();",
                    "var address2 = Ext.getCmp('address2RegField').getValue();",
                    "var city = Ext.getCmp('cityRegField').getValue();",
                    "var sp = Ext.getCmp('spRegCombo').getValue();",
                    "var country = Ext.getCmp('countryRegCombo').getValue();",
                    "var pass = Ext.getCmp('passRegField').getValue();",
                    "var occupation = Ext.getCmp('occupRegField').getValue();",
                    "var premiumCode1 = Ext.getCmp('pCodeField').getValue();",
                    "var user;",
                    "",
                    "if(!Ext.getCmp('userRegPanel').isValid()){",
                    "    Ext.Msg.alert(\"Register\", \"Please fill out required fields\");",
                    "    return;",
                    "}else{",
                    "    Ext.Ajax.request({",
                    "        url : \"getUserByEmail\",",
                    "        method : \"GET\",",
                    "        async : false,",
                    "        params : {",
                    "            email : email",
                    "        },",
                    "        callback : function(options, success, response) {",
                    "            if(!Ext.isEmpty(Ext.decode(response.responseText))){",
                    "                Ext.Msg.alert('Register','Account with that email already exists.');",
                    "            }else{",
                    "                Ext.Ajax.request({",
                    "                    url : \"premiumRegister\",",
                    "                    method: 'POST',",
                    "                    params : {",
                    "                        premiumCode: premiumCode1",
                    "                    },",
                    "                    async: false,",
                    "                    callback : function(options, success, response){",
                    "                        if(response.responseText==='success'){",
                    "                            user = {",
                    "                                \"userId\":'',",
                    "                                \"userFname\":fname,",
                    "                                \"userLname\":lname,",
                    "                                \"userEmail\":email,",
                    "                                \"userPass\":pass,",
                    "                                \"userOccupation\":occupation,",
                    "                                \"userAddress1\":address1,",
                    "                                \"userAddress2\":address2,",
                    "                                \"userCity\":city,",
                    "                                \"userSp\":sp,",
                    "                                \"userCountry\":country,",
                    "                                \"userType\":'Customer',",
                    "                                \"userLevel\":2",
                    "                            };",
                    "                        }else{",
                    "                            user = {",
                    "                                \"userId\":'',",
                    "                                \"userFname\":fname,",
                    "                                \"userLname\":lname,",
                    "                                \"userEmail\":email,",
                    "                                \"userPass\":pass,",
                    "                                \"userOccupation\":occupation,",
                    "                                \"userAddress1\":address1,",
                    "                                \"userAddress2\":address2,",
                    "                                \"userCity\":city,",
                    "                                \"userSp\":sp,",
                    "                                \"userCountry\":country,",
                    "                                \"userType\":'Customer',",
                    "                                \"userLevel\":1",
                    "                            };",
                    "                        }",
                    "                    }",
                    "                });",
                    "",
                    "",
                    "                Ext.Ajax.request({",
                    "                    url : \"register\",",
                    "                    method: 'POST',",
                    "                    params : {",
                    "                        user: Ext.encode(user)",
                    "                    },",
                    "                    async: false,",
                    "                    jsonData: Ext.util.JSON.encode(user),",
                    "                    callback : function(options, success, response){",
                    "                        if(Ext.isEmpty(response.responseText)){",
                    "                            Ext.Msg.alert('Register','There is a problem with the registration. Please try again later');",
                    "                        }else{",
                    "                            var resp = Ext.decode(response.responseText);",
                    "                            if(resp.responseCode=='0'){",
                    "                                Ext.Msg.alert('Register','User \"' + email + '\" successfully registered!');",
                    "                                var mainControl = W5D5_Project.app.getController('MainController');",
                    "                                mainControl.clearFrontPage();",
                    "                            }else if(resp.responseCode=='999'){",
                    "                                var msgs = '';",
                    "                                Ext.each(resp.errors, function(error){",
                    "                                   msgs = msgs + '<br>' + error.defaultMessage; ",
                    "                                });",
                    "                                Ext.Msg.alert('Register','Validation error. Please check the following: '+msgs);",
                    "                            }else{",
                    "                                Ext.Msg.alert('Register','There is a problem with the registration. Please try again later');",
                    "                            }",
                    "                        }",
                    "                    }",
                    "                });",
                    "            }",
                    "        }",
                    "    });",
                    "}",
                    "",
                    "",
                    "",
                    "",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onRegisterBtnClick",
            "designerId": "dfdfe741-dba7-43ea-9be4-a96c3e75a83e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#contactSendBtn",
                "designer|targetType": "MyButton12",
                "fn": "onContactSendBtnClick",
                "implHandler": [
                    "var fname = Ext.getCmp('contactFnameField').getValue();",
                    "var lname = Ext.getCmp('contactLnameField').getValue();",
                    "var concern = Ext.getCmp('contactConcernCombo').getValue();",
                    "var msg = Ext.getCmp('contactMessageText').getValue();",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onContactSendBtnClick",
            "designerId": "52b1557a-a135-4123-b4f4-6d86c63ce94d"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#loginForgotBtn",
                "designer|targetType": "MyButton13",
                "fn": "onLoginForgotBtnClick",
                "implHandler": [
                    "var contact = Ext.getCmp('contactPanel');",
                    "var home1 = Ext.getCmp('mainController');",
                    "",
                    "contact.show();",
                    "home1.hide();"
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onLoginForgotBtnClick",
            "designerId": "27ec022f-050e-4e00-ae1c-12241cc37352"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#reg1Cntr",
                "designer|params": [
                    "me, field"
                ],
                "designer|targetType": "MyContainer2",
                "fn": "onReg1CntrBeforeAdd",
                "implHandler": [
                    "if (!field.allowBlank){",
                    "field.labelSeparator += '<span style=\"color: rgb(255, 0, 0); padding-left: 2px;\">*</span>';",
                    "}"
                ],
                "name": "beforeadd",
                "scope": "me"
            },
            "name": "onReg1CntrBeforeAdd",
            "designerId": "ab37c064-614c-4e93-ab25-012fc0e581ed"
        }
    ]
}