/*
 * File: app/controller/LoginController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('W3D5_Project.controller.LoginController', {
    extend: 'Ext.app.Controller',

    id: 'Login',

    onLoginBtnClick: function() {
        var store =Ext.getStore('UserStore');
        var valid = false;
        var id;
        var username = Ext.getCmp('loginusername').getValue();
        var password = Ext.getCmp('loginpassword').getValue();
        Ext.each(store.data.items, function(rec){
            if(rec.data.username==username && rec.data.password==password){
                valid = true;
            }

        });
        if(valid){
            if(Ext.isEmpty(this.mainWin)){
                this.mainWin = Ext.create('W3D5_Project.view.MainViewport', {});
            }
            this.mainWin.show();
            this.mainWin.unmask();
            Ext.getCmp('UserNameField').setValue('Welcome! ' + username);
            Ext.getCmp('UserNameId').setValue(id);

            if(username=='admin'){
                Ext.getCmp('MenuPanel').items.items[3].enable();
                Ext.getCmp('MenuPanel').items.items[4].enable();
                Ext.getCmp('MenuPanel').items.items[5].enable();
            }else{
                Ext.getCmp('MenuPanel').items.items[3].disable();
                Ext.getCmp('MenuPanel').items.items[4].disable();
                Ext.getCmp('MenuPanel').items.items[5].disable();
            }

                 if(Ext.isEmpty(this.loginWin)){
                 this.loginWin.hide();
                 this.loginWin.mask();
             }
            if(Ext.isEmpty(this.registerWin)){
                 this.registerWin.hide();
                 this.registerWin.mask();
             }
        }else{
            Ext.MessageBox.show({
                title: 'Failed Login',
                msg: 'Please enter a registered account',
                buttons: Ext.Msg.OK,
                icon: Ext.Msg.WARNING

            });

        }
    },

    onRegisterBtnClick: function() {
        if(Ext.isEmpty(this.registerWin)){
            this.registerWin = Ext.create('W3D5_Project.view.RegisterViewport', {});
        }
        this.registerWin.show();
        this.registerWin.unmask();
        if(Ext.isEmpty(this.loginWin)){
                         this.loginWin.hide();
                         this.loginWin.mask();
                     }
                    if(Ext.isEmpty(this.mainWin)){
                         this.mainWin.hide();
                         this.mainWin.mask();
                     }
    },

    init: function(application) {
        this.control({
            "#LoginBtn": {
                click: this.onLoginBtnClick
            },
            "#RegisterBtn": {
                click: this.onRegisterBtnClick
            }
        });
    }

});
